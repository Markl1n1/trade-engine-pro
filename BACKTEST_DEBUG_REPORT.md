# üîß Backtest SL/TP/Trailing Stop Debug Report

## üêõ **–ü–†–û–ë–õ–ï–ú–ê**

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π SL/TP/Trailing Stop –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±—ç–∫—Ç–µ—Å—Ç–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –º–µ–Ω—è—é—Ç—Å—è.

## üîç **–ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´**

### **1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```typescript
// Frontend (Backtest.tsx)
stopLossPercent: parseFloat(stopLossPercent),
takeProfitPercent: parseFloat(takeProfitPercent),
trailingStopPercent: parseFloat(trailingStopPercent),
```

### **2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –≤ Edge Functions:**
```typescript
// run-backtest/index.ts
const { 
  stopLossPercent, 
  takeProfitPercent,
  trailingStopPercent,
  // ...
} = await req.json();
```

### **3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ Enhanced Backtest Engine:**
```typescript
const backtestConfig = {
  stopLossPercent: stopLossPercent ?? strategy.stop_loss_percent,
  takeProfitPercent: takeProfitPercent ?? strategy.take_profit_percent,
  trailingStopPercent: trailingStopPercent,
  // ...
};
```

## üîß **–í–ù–ï–°–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### **1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```typescript
// run-backtest/index.ts
console.log(`[BACKTEST] Parameters received:`, {
  stopLossPercent,
  takeProfitPercent,
  trailingStopPercent,
  initialBalance,
  productType,
  leverage
});
```

### **2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Enhanced Backtest Engine:**
```typescript
// backtest-engine.ts
console.log(`[BACKTEST] SL/TP/Trailing parameters:`, {
  stopLossPercent: this.config.stopLossPercent,
  takeProfitPercent: this.config.takeProfitPercent,
  trailingStopPercent: this.config.trailingStopPercent
});
```

### **3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ TrailingStopManager:**
```typescript
// backtest-engine.ts
constructor(trailingPercent: number) {
  this.trailingPercent = trailingPercent;
  console.log(`[TRAILING] Initialized with ${trailingPercent}% trailing stop`);
}
```

### **4. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Simple Backtest:**
```typescript
// run-backtest-simple/index.ts
console.log(`[Simple Backtest] Parameters received:`, {
  stopLossPercent,
  takeProfitPercent,
  trailingStopPercent,
  initialBalance,
  productType,
  leverage
});
```

## üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï**

### **–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã SL/TP/Trailing Stop:**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫—Ç–µ—Å—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:**
   - SL: -45%, TP: 45%, Trailing: 20%
   - SL: -30%, TP: 30%, Trailing: 15%
   - SL: -60%, TP: 60%, Trailing: 25%

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ Supabase:**
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TrailingStopManager
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ SL/TP/Trailing Stop

3. **–°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫ –¥–æ–ª–∂–Ω–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
   - –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è

## üîç **–í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´ –ü–†–û–ë–õ–ï–ú–´**

### **1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
- –ë—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- Supabase –º–æ–∂–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å Edge Functions

### **2. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã:**
- –ï—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã, SL/TP –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—é—Ç
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–∫—Ç–∏–≤–Ω–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã

### **3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è:**
- –í–æ–∑–º–æ–∂–Ω–æ, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–¥–µ

### **4. –õ–æ–≥–∏–∫–∞ SL/TP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –í–æ–∑–º–æ–∂–Ω–æ, –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ SL/TP –∏–º–µ–µ—Ç –æ—à–∏–±–∫–∏
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è

## üöÄ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ**

### **1. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à:**
```bash
# –í –±—Ä–∞—É–∑–µ—Ä–µ
Ctrl + Shift + R (–∂–µ—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)

# –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
```

### **2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
- –û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools ‚Üí Console
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫—Ç–µ—Å—Ç
- –ù–∞–π–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### **3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:**
- –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å –æ—á–µ–≤–∏–¥–Ω—ã–º–∏ —Å–∏–≥–Ω–∞–ª–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥ (1-2 –¥–Ω—è)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã

### **4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```typescript
// –í –∫–æ–¥–µ –µ—Å—Ç—å fallback –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
stopLossPercent: stopLossPercent ?? strategy.stop_loss_percent,
takeProfitPercent: takeProfitPercent ?? strategy.take_profit_percent,
```

## üìä **–û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´**

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ SL –¥–æ–ª–∂–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ TP –¥–æ–ª–∂–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫  
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ Trailing Stop –¥–æ–ª–∂–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –æ–±—â—É—é –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ SL/TP/Trailing Stop

### **–ü—Ä–∏–º–µ—Ä—ã –æ–∂–∏–¥–∞–µ–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- **SL -45% ‚Üí -30%**: –ú–µ–Ω—å—à–µ —É–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫, –±–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö
- **TP 45% ‚Üí 30%**: –ú–µ–Ω—å—à–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
- **Trailing 20% ‚Üí 15%**: –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π

## üéØ **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç** —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ –∫–æ–Ω—Å–æ–ª–∏ Supabase
3. **–°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
4. **–°–æ–æ–±—â–∏—Ç–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö** –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üîß **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞**
2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–∫–∞—Ö**
3. **–í–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º**
4. **–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏**

---

**–°—Ç–∞—Ç—É—Å**: üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî• –í—ã—Å–æ–∫–∏–π (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
