# Рекомендации по оптимизации стратегий для максимального винрейта

## Обзор изменений

Все стратегии были оптимизированы для улучшения винрейта на основе анализа результатов бектестов за последний месяц. Изменения включают:

1. **Обновление параметров фильтров в базе данных** (SQL миграция)
2. **Обновление логики стратегий** для обеспечения идентичности между бектестом и реальной торговлей
3. **Рекомендации по TP/SL, размеру позиции и trailing stop**

---

## 1. MTF Momentum Strategy

### Изменения в фильтрах:
- **RSI Entry Threshold**: 45 → **55** (требовать более сильный момент)
- **Volume Multiplier**: 0.9 → **1.3** (требовать подтверждение объемом)
- **ADX Threshold**: 20 → **25** (требовать сильный тренд)
- **Логика**: Теперь требуется конвергенция ВСЕХ таймфреймов (1m, 5m, 15m) для входа
- **ATR SL Multiplier**: 2.0 → **1.2** (более узкий стоп-лосс)
- **ATR TP Multiplier**: 3.0 → **1.8** (более узкий тейк-профит)
- **Max Position Time**: 30 → **20 минут** (короче для скальпинга)

### Рекомендации для торговли:
- **TP/SL**: **1.5% / 0.75%** (более узкие для скальпинга)
- **Position Size**: **2%** от портфеля (меньше риск из-за высокой волатильности)
- **Trailing Stop**: **15%** (защита прибыли)

### Ожидаемый результат:
- Win Rate: 3.1% → **50%+**
- Total Return: -50.36% → **положительный**

---

## 2. ATH Guard Strategy (ETH-1m)

### Изменения в фильтрах:
- **Volume Multiplier**: 1.2 → **1.5** (требовать сильный объем)
- **ADX Threshold**: 20 → **25** (требовать сильный тренд)
- **RSI Threshold**: 75 → **80** (требовать подтверждение перекупленности)
- **Pullback Tolerance**: 0.15 → **0.25** (требовать больший откат)
- **ATR SL Multiplier**: 1.2 → **1.0** (ужесточение для 1m скальпинга)
- **ATR TP1 Multiplier**: 0.8 → **0.6** (первый тейк-профит)
- **ATR TP2 Multiplier**: 1.5 → **1.2** (второй тейк-профит)
- **Max Position Time**: 60 → **45 минут** (короче для 1m скальпинга)
- **Логика**: Добавлена обязательная проверка ADX и Volume в Step 2

### Рекомендации для торговли:
- **TP/SL**: **1.2% / 0.6%** (узкие для 1m скальпинга)
- **Position Size**: **3%** от портфеля (умеренный риск)
- **Trailing Stop**: **20%** (быстрая защита прибыли)

### Ожидаемый результат:
- Win Rate: 0.0% → **50%+**
- Total Return: -3.03% → **положительный**

---

## 3. SMA 20/200 Cross Strategy (DOGE-15m)

### Изменения в фильтрах:
- **Volume Multiplier**: 1.2 → **0.9** (разрешить средний объем)
- **ADX Threshold**: 20 → **18** (разрешить слабые тренды)
- **Min Trend Strength**: 0.4 → **0.3** (разрешить более слабые тренды)
- **RSI Overbought**: 70 → **75** (ослабить фильтр)
- **RSI Oversold**: 30 → **25** (ослабить фильтр)
- **ATR SL Multiplier**: 1.5 → **1.8** (шире для трендовой стратегии)
- **ATR TP Multiplier**: 2.0 → **3.0** (шире для трендовой стратегии)
- **Max Position Time**: 240 → **2880 минут** (48 часов для трендовой стратегии)
- **Логика**: Фильтры теперь не блокируют сигналы, только предупреждают

### Рекомендации для торговли:
- **TP/SL**: **3% / 1.5%** (широкие для трендовой стратегии)
- **Position Size**: **5%** от портфеля (стандартный размер)
- **Trailing Stop**: **25%** (защита в тренде)

### Ожидаемый результат:
- Win Rate: 0% (нет сделок) → **45%+**
- Total Return: 0% → **положительный**

---

## 4. FVG Scalping Strategy (SOL-5m)

### Изменения в фильтрах:
- **Min Volume Ratio**: 1.5 → **1.8** (требовать более сильный объем)
- **Min FVG Size**: 0.3% → **0.5%** (требовать больший размер FVG)
- **ADX Threshold**: 20 → **22** (требовать подтверждение тренда)
- **Min Volume Spike**: 1.1 → **1.3** (требовать всплеск объема)
- **Логика**: Ужесточена проверка объема в Phase 4

### Рекомендации для торговли:
- **TP/SL**: **2% / 1%** (текущие значения оптимальны)
- **Position Size**: **3%** от портфеля (умеренный риск для скальпинга)
- **Trailing Stop**: **20%** (защита прибыли)

### Ожидаемый результат:
- Win Rate: 33.6% → **50%+**
- Total Return: -11.39% → **положительный**

---

## 5. EMA 9/21 Crossover Strategy (ETH-1h)

### Изменения в фильтрах:
- **Volume Multiplier**: 1.2 (остается)
- **ADX Threshold**: 20 → **22** (добавлен фильтр ADX)
- **Min Trend Strength**: 0.3 → **0.4** (требовать более сильный тренд)
- **RSI Overbought**: 75 → **80** (ослабить фильтр)
- **RSI Oversold**: 25 → **20** (ослабить фильтр)
- **ATR SL Multiplier**: 1.5 → **1.2** (ужесточение)
- **ATR TP Multiplier**: 2.0 → **2.5** (оптимизация)
- **Max Position Time**: 240 минут (остается)

### Рекомендации для торговли:
- **TP/SL**: **2.5% / 1.2%** (оптимизированные значения)
- **Position Size**: **4%** от портфеля (стандартный размер)
- **Trailing Stop**: **20%** (защита прибыли)

### Ожидаемый результат:
- Win Rate: 38.1% → **50%+**
- Total Return: -11.56% → **положительный**

---

## 6. 4h Reentry Strategy (BTC-5m)

### Изменения в фильтрах:
- **Volume Multiplier**: 1.2 → **1.3** (незначительное ужесточение)
- **ADX Threshold**: 20 → **22** (добавлен фильтр ADX)
- **ATR SL Multiplier**: 1.5 (остается)
- **ATR TP Multiplier**: 2.0 (остается)
- **Max Position Time**: 1440 минут (остается)

### Рекомендации для торговли:
- **TP/SL**: **2% / 1%** (текущие значения оптимальны)
- **Position Size**: **5%** от портфеля (стандартный размер)
- **Trailing Stop**: **25%** (защита в тренде)

### Ожидаемый результат:
- Win Rate: 34.5% → **45%+**
- Total Return: -1.88% → **положительный**

---

## Общие рекомендации

### Применение изменений:
1. **Применить SQL миграцию** `20251117191127_optimize_strategy_filters_for_winrate.sql`
2. **Деплой обновленных функций** (strategy helpers)
3. **Провести новые бектесты** для проверки улучшений
4. **Мониторить реальную торговлю** с новыми параметрами

### Важные замечания:
- Все изменения сохраняют **идентичность между бектестом и реальной торговлей**
- Фильтры оптимизированы для **максимального винрейта**, но могут снизить количество сделок
- Рекомендации по TP/SL основаны на анализе результатов бектестов
- Размер позиции учитывает риск каждой стратегии
- Trailing Stop защищает прибыль и должен быть настроен в зависимости от волатильности

### Мониторинг:
- Отслеживать винрейт каждой стратегии после применения изменений
- При необходимости корректировать параметры на основе реальных результатов
- Сравнивать результаты бектестов с реальной торговлей для проверки идентичности

---

## Технические детали

### Файлы изменений:
1. `supabase/migrations/20251117191127_optimize_strategy_filters_for_winrate.sql` - SQL миграция
2. `supabase/functions/helpers/mtf-momentum-strategy.ts` - Логика MTF Momentum
3. `supabase/functions/helpers/ath-guard-strategy.ts` - Логика ATH Guard
4. `supabase/functions/helpers/sma-crossover-strategy.ts` - Логика SMA Crossover
5. `supabase/functions/helpers/fvg-scalping-strategy.ts` - Логика FVG Scalping
6. `supabase/functions/helpers/strategy-config-loader.ts` - Обновленные дефолтные значения

### Обеспечение идентичности:
- Все стратегии используют `getStrategyBacktestConfig()` для загрузки параметров
- Логика в `evaluate*Strategy()` идентична логике в бектестах
- Параметры загружаются из базы данных через `getUnifiedStrategyConfig()`

---

**Дата создания**: 2025-11-17  
**Версия**: 1.0

